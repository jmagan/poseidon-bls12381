import { poseidonPermutation } from "../poseidon";

// The parameters are generated by the scripts provided in the repo: https://extgit.iaik.tugraz.at/krypto/hadeshash.
// This repo is the reference implementation of the paper. We follow the recommendation from the updated paper and we
// use the script generate_params_poseidon.sage

// This pareameters are genereated: sage generate_params_poseidon.sage 1 0 255 2 5 128 0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001

const ROUND_CONSTANTS = [
  0x6267f5556c88257324c1c8b00d5871b2eba13cc39d72aa10dde6b69bc44c41c7n,
  0x30347723511438a085118166c68bf0c4f4ab5c10a2c55adb5cf87cc9e030f60fn,
  0x10db856965e40038eb6427303181e7b7439f1a051aa4630c26cf86d0a0451a4bn,
  0x5a3d2dcd541e4faaae7eb143eec847a0f652b6dc1b92e3f39ec23c808b3a5d63n,
  0x3b07f0ff7edcf93b1dd0487bc9fab1c6905f9ceee38dcce83efeb3a320398526n,
  0x40c73c524b9fd0fab63128175befe07b5c63ccdde9ca10e1a37205c9607fdf8an,
  0x3a933861cf23752376d94dbb24b0f3c61630787928875c07672b68abfb9191e0n,
  0x71cc165e208570b2d5ef81db84e3c5e714ea4edfb36fc7fb11ef65a64b2d9755n,
  0x6c0dc9eb332b5d968bec8ad68fe24ce34087ea54093f153618434475bce402f8n,
  0x0af5bafd335dae5c86967b11d5dcefb986a54c9d60d35eb06dc7a3fd779b3906n,
  0x6e12847918f030f2626c150ab69e4be0f13d202ae1f8bc87ea74323e93372e3bn,
  0x5565d40e21d059a26db241ca125d9316283eadf144b1318e604e253eeae1fe9an,
  0x608e01b42d3dca09fed9b54eadaaba3e4ce6aefe92b0dc954a0fa4683a9678f2n,
  0x16bbe434b24f94e2c40ed1f4f9bd7d17e5be96c3aec15579b35fd80f0f80de9en,
  0x0d1be811a8e73220cab01ce981d475522c3d7dd9e2716c3a2cf4ddd541546890n,
  0x5997a3affb18f942868b86f8ee10a68966e90bac7bbd8c65ede7e6e5ef1f6320n,
  0x4d92e86d270041061eec80278079fca771499dea5ccdc99682a953bb3a038b8en,
  0x616c8c5ce232b9314f694fc6a968446ea9daf7a4079ce1a75fcc950741d680bbn,
  0x677e31e7846d9131bdc350eaf11a8ff918dd258ddd800444424afab34dfdfe3dn,
  0x4e7d7f85aefc110b233525ee3e53851aee7d3241e2a132585e0e25005eee0b0en,
  0x06a8b4539488b7dddc48c3a226dbda313f906e106f844196d55013d321244f13n,
  0x5091517b6a85783108999f8e6bda3c793bef3f2e9589641d260bdfde8bdef00dn,
  0x0d2703e5b30f54d7f414e901802d54f8c14cd6355415df6e0f063d16bef9c43an,
  0x56f69096811148eb38eec143d32565c077b3d1a4a4351f2b458f43b1659d4495n,
  0x622d94d38d1ded428afd062008c5709b43a678f6ba518ec56383e8ffba473504n,
  0x2730c607bba7333723a4a44577819b7db82a24574f6d13eee4c856c1ca3de9c7n,
  0x01ac5f59256c5004dc1043c53b23800a3fbab53eb1a83f551056f227b514b9f6n,
  0x0790b92523c973f1c95b94937afbb5796d89481e7a56328b44bab5ba81ae42f3n,
  0x1d63b59d97bc269d13964fb3e8771d0acc749bc83eb2f0372484e266142bb8c0n,
  0x1a52d04e5f14a3a05f7a01262df9e68c77fdf7e2bfb56c8b252d2140efdf0914n,
  0x5aa9b3b808812b284857e8622843a8717fa5cb49b217017f31d79e8d0f963fc0n,
  0x6a3d18fdbeb1d77ec1304539b00e6188786dbbc4435269b4c6281367f42656e3n,
  0x4743e860df269a85dd76fb99dbe9d840eb669dc859754b3f74805e57ba288b00n,
  0x6c32cac3946825f80a434c5ab397fc1a1c6a9bdfaab53175d4cf3d29ddb6cbc6n,
  0x333b0eea5da7ed1e3959d16280a361aa77dd24ecbfb28e1b2583ac4e9894305cn,
  0x3b503fc333b795ccc0c5bb3ae26b077dc3742cb745ec8821648c5ce7ebd9df18n,
  0x4fa5853188d9f728a17532d94bee6fb28fee510380a5d50927c6c5b1ce283444n,
  0x5d2ed8a6603a905bac490ebfb9e6c18f0bc9da1bbc2173291b18de6b6186118fn,
  0x2d830a53584c5556264852f075c78f7f9eb068016ae88af9cda933d6ae52eca7n,
  0x0250f4d6780ad29ae60e55f135b9ac80ccc7c81e3add37db276c26f1a2b1b86en,
  0x6e3e9595f59220599e23e830728d4a0c4d62515ec1ed10b72446cf4df5b4c308n,
  0x2cd3314555d6faf23ee90cdb884f1c4697ebe98e3a450a624c4d896233b93cd5n,
  0x584a408d0f370543b8413fee70a060a394e561f504d8679f7bece4bf222e4108n,
  0x499cd53437b9fcbf7479c00fcc21295759074ce9bd1bb1fbd3460237aef4759en,
  0x56a9b567bd0646effd0608d74d537991136098d9a06af6cb3ff8f010efb57578n,
  0x6a5fae2b00d968b931441b374e27ba4d03b306bd602d48731677169e75a67e8cn,
  0x2e1cc28e390e64aa1d60edb99c0aeda7c8c32bdb01ba11abbad5026b46eccb27n,
  0x2d4820000675df7c276beac408fe2e851e734a7008ae09bbcb3c96c70024f71bn,
  0x0c2fe101a2b52b538b902c6b2dc992cb266f7636e05b0c068385b5fa19e97142n,
  0x209b790b78c0e7927c6a178ef2f00b8687fc7bd4f21a9e02578551535002bc95n,
  0x2dd0926cf56bbaaec6491513d08a9983f94a910852a7b4ea4bd4222b93e14c10n,
  0x4316b39dd7d65b1bb575198104d409b169236a7ade371f7ab176fcbae75a5f0dn,
  0x540276d61041b91f6ea3068ec260a9338b6e3da15d934e648c24f35aee04e535n,
  0x37af612900b839977b146324c84772c58a4ccc0f6494cc054571827e74bfd2d3n,
  0x2af00c93d59ed14c9911e5cb3781d772371e83228e4267bbce11d065c1955338n,
  0x62b48779b0cf7ff2c10fd9b91a6ff7b7a99f935e961a5a94aa38f9d4f71c8b4cn,
  0x540bf5bbe01f28563bcbe11a2ce346d8231a2cdd0fe07641f9fa89e5c21978e3n,
  0x232b6c847a6d23912cb10ecbe50b53491f67f71e9b87a4a30446f2218017874bn,
  0x0ab34adbe77b8f1e57a370e4fd626071eea74b3f0b66644a629efaa0e96456c0n,
  0x1a83e43ef118c90046b1bdbeab8dd5cdcab632807c2cd0dc9147cbc5b7084be8n,
  0x1ec6fa41b41b672d9005468720918130b642567462a3d557a595d4dc6c56f2f9n,
  0x01f81a153199a751a111b8f5212cfc5bf82aacf0287d03e1864f8e5713fe4a17n,
  0x2617307587a675f4ecd73a54a7b206162d751cabf3d9fd007bcca4de2c6f0649n,
  0x1647be94c515178c7974a245624b642bb1ae6e2d4e1682087e362d7f98bc953fn,
  0x6e690b956e00b9e339dec49d675586f661f9b081ee3fa7696d73977658aa6fean,
  0x660b85bc22de06d476c47bf084ad436f59874f1d630c0f5c91fbef51d5e738c5n,
  0x32bf3d451b69dde075fc370eaa8c1b77b5c0bc2aab1c7b46da7ef9d1840b0419n,
  0x73924b40beaa9c1ce4074c2154d1af4d658c09395a568b99b2fbcc3b5685e810n,
  0x17cbb3ee0adcb9d977e96e9152b36042925244fdd0aa184c7a89a58a2dc40097n,
  0x29d76a821e3220775c552f6b5977ab94956e52b8dac36ef88ace050d553766a3n,
  0x62b1a6c06ab26881a1fe57eceac56b5aec0b96da7211557f4e27ec24296d7db6n,
  0x0dfc474151e5c605a693a51ae8227cc0a99fdc4524fc2810c6eda9035d04334dn,
  0x3e287088506bb38d2ed465cdab37a7b2eedafb47557446a9aec9d366a91b1d98n,
  0x2641d2919d0bed24673c9effc24578798c56f3cd39940030aff2c913cf58974an,
  0x286c1f841a05bb667c84d93ba9359da901a545ecb1c6a37403c5e74d0a663cf9n,
  0x68159ff06a0aff28d53ecaae5654db9f3017f564378fccb68af2a47f10788d17n,
  0x432ff6c037e9ce6e61172862cc076d925d00f4414fa4f4d8722c4b1460c2f04bn,
  0x5e1a35f47c87b33cd37544c51d7dda1d7e262af52b11133df163d2c94e9f0674n,
  0x0b8d4686183872494b4416fc82317a4deae10e7c312aeb8a44697b49b1025df5n,
  0x6291c6d458499cffd8915196bde5fdcdb7eb5ef6b1e6d15aab7d8e95cda2c564n,
  0x0e2f4df2de6504553f057c1046bb04decf779baff7457cce028c4f55d4f4f0edn,
  0x1694268ccf0cf400d1c77259d9766437e5a35810b854022829ead0b3e70aeba4n,
  0x3c96c51a30dc76af38c9c08c36ee90b626c28910a0994e0854b5375e7f46698bn,
  0x5a99402864789e9d2bd2930a70a54adb66865923b4a17ef36a107020e44a73dcn,
  0x5a22c7703f1ab4a55031fc34aab0732018e931ba48c8c38c65bfaf5e610ab7afn,
  0x686fea106123473955c3e9365afa2238a5e35390360884ed7555a8c5f8d66a20n,
  0x6a68607546ff48f9d154b924ccf0fd85b608ad351e4bcffd6097d4d175ea53bcn,
  0x21077e81fe5a0bde7f6f2631f93cb33d07d1928befec6a434bc0616ef5b3dddbn,
  0x11aeb10c549bc49d3ea21f84ea42ba3374a80c7504186d3c9c9476e7a380fb90n,
  0x4dfbc6f6a54a316d331770308f53534a01f4b9a50210cb081fdee076e3fd6871n,
  0x0e9ba2efbd177a7c3e3ba0716b5de50a24937f94bd97491941e064704a024904n,
  0x1dda541f2f744aaee3c50c2d9abc405d8fbd01e3e5c22f4192d893f45788e9d6n,
  0x2ec1165caf7fd1589fbd8cf29049439a0c266d9c002c5d77b656a2e28db097b3n,
  0x1f8cc6e561bde673e0bbbfb882419c31575e4b7ae66cde549443f95dc23566ecn,
  0x57d97d4b02423d7738690fbea9e0b7ba8eb1ad651986f869ff96a932fedbe6d3n,
  0x1205704bf8e95ba26bca37a88295daeba494546ea8efe7189efb000e0bcfbdd0n,
  0x016cdeebdb6f8b37fbbd4ef80645d2473d21df81eee935ec540836f06eb49d38n,
  0x19b8a2f4a6403c98add6f220ff4938fe7b5ca43c78095f14184923bdfa0cae33n,
  0x19358aab5822facc694ee0a27a4ec9fb6bf931d5efb8ce59c25d67bb017e26d5n,
  0x0c7a80ba8f7372a2bee14572b6967720c9853f811188cd44fe24e764a2e7affen,
  0x3894fe113139129d6f42058e3f871ac109b87f7fcffc317321cc1e428f9b48c4n,
  0x1aefc0785946d65ef0e62be601da8cad8e94f5e3f96a177c235740d5fb406ab9n,
  0x0af1c4fc0b49030fe545ef543ac1b16640288c36554ee106e7d1e06a4e1626b3n,
  0x5848a8b1f2645e1c36b603a083689b50b760744f96bdf07a2df821e584023884n,
  0x1318aac0f0ef72e5e0233ca168ea6c21a4e162e00d3ba70d79087df4660154f4n,
  0x4179cc529ed5ddd4aa1acf77e50d12bb9a754df8bfcb0ff6c6e1073e8cbfe8ean,
  0x005983d5e4d5d48c2c80a4dd83083db023217247ece5e0514e49b90cd73e3d05n,
  0x5c198603562a2e473d5486f461f4fc776051ab0bfc00526df55541b87e47c11bn,
  0x39c93d11962620d7c5396532137173d6746356c6821ff03734d59af52a6ad067n,
  0x2475bc5acc012b8083fcc7d2ccb15127a2bc7bec09dbce1319e5f680bed75fa7n,
  0x66729d8d26c113573bcb9dcd84bdbca5fb0aede246e1f5659762ce88a38abc7an,
  0x0bb442eba5baf8e728df8eb9c2cb17ed8ac2909427f0a608ddbede534265c995n,
  0x4a432bd0cf7b12c3f31ff6ef7033982cfb702a89df14ad1457e9e108e0093e0fn,
  0x3d120149595e0c7fa884fe33f287ea54841a94be027702ea9881ad9227204ecdn,
  0x35e47349a427ba8b1df4bf4f5f1da532f25c44be406a90def22e870301d051e0n,
  0x19caf5fbbc0a1424525971b573841109f36dc3e07eb1df7fd69d4e1fd34abcecn,
  0x4d94360247806752a4c1e622c2964069456601b666c900aa8686ae74c00d33ben,
  0x515cce538dcf5280c18d4d2973a2fd4eda2304d6f0bb0b45d01bf9a2b1fcae38n,
  0x5d157e3dbf20d63c3e0783a96c763b96f28ad0548a44fabba29463d5fb759390n,
  0x50c6439188ea7d8153949b6f5f64c10df7bf884d31b9680323781406fc84d4c8n,
  0x06ab7adf0f997badc0b95360e3d992b0d5dafe9fce2c807f5de11ea819123651n,
  0x6212d6f6db15bcc7f3b1637efbfa8d08c5faebeab89d265bb7a0585b96306900n,
  0x5f674e12cce1d53f2d01b06ea1874335f8c7634443b29b300ff011a4e4822783n,
  0x01865aba8ec3d89aca45cc1da7d8ca5e2b31a8a44178a0d6e665fbe83d63cdd2n,
  0x221d9df33836d262a34e9566471db96efbe80c8e0602d8ea7af1c2560afc4ed9n,
  0x0f12e59c448a18bae09585d74c637be4ef24ec3d5ba000964cf76c6032d159afn,
  0x10376fa0adb3a50540dfd9aa95fa8b5c120f4e6843590ed156b5fcb93ecb7a27n,
  0x031597a49ea890a50ed8381799fa51e27e540902ada5f8d8a7529a980458eac8n,
];

const MDS_MATRIX = [
  [
    0x1e6d0cd936714f2124fc4c78321266174fe2855e689c6511a36ecadc3cccc268n,
    0x1240406fed29618b5515b2170437e1cbe9dbf814d630e4c71109f74a157a9bcdn,
  ],
  [
    0x70720066b0150aa415f3fff26ea0b231e657f63112a36a97f0833f3c18dfa4c5n,
    0x6b07f55f01bb144fece2d7068241cef3eda1aba1730dab73367f3d06e994a23en,
  ],
];

export function poseidon1(inputs: bigint[] | string[]): bigint {
  if (!Array.isArray(inputs) || inputs.length !== 1)
    throw new Error(`Expected an array with 1 elements, but got ${inputs}`);

  inputs = inputs.map((input: any, index: number) => {
    if (typeof input === "string") {
      try {
        return BigInt(input);
      } catch (error) {
        throw new Error(
          `Failed to convert element at index ${index} to BigInt: ${error}`,
        );
      }
    } else if (typeof input !== "bigint") {
      throw new Error(
        `Expected a BigInt or String, but got ${input} at index ${index}`,
      );
    }
    return input;
  });

  return poseidonPermutation(inputs, 8, 56, ROUND_CONSTANTS, MDS_MATRIX)[0];
}
